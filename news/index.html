<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>News - Fowlerville Wrestling</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  <script>window.NAV_BASE = '../';</script>
  <script src="../js/nav.js"></script>

  <div class="container">
    <h1 class="section-title" style="margin-top:1rem;">News & Updates</h1>

    <div style="display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:1.5rem;">
      <input type="text" id="search" class="search-bar" placeholder="Search posts..." style="flex:1;min-width:200px;">
      <div id="tag-filters" style="display:flex;gap:0.4rem;flex-wrap:wrap;align-items:center;"></div>
    </div>

    <div id="post-list" class="post-list"></div>

    <div id="no-results" style="display:none;text-align:center;padding:3rem;color:var(--text-light);">
      No posts match your search.
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-links">
      <a href="../index.html">Home</a>
      <a href="../youth/index.html">Youth Club</a>
      <a href="../hs/index.html">High School</a>
      <a href="../about.html">About</a>
    </div>
    <div class="footer-copy">Fowlerville Wrestling &mdash; Fowlerville, Michigan</div>
  </footer>

  <script>
    const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    let allPosts = [];
    let activeTag = null;

    function formatDate(dateStr) {
      const d = new Date(dateStr + 'T00:00:00');
      return MONTHS[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
    }

    function stripHtml(html) {
      return html.replace(/<[^>]+>/g, '');
    }

    function renderPosts(posts) {
      const container = document.getElementById('post-list');
      const noResults = document.getElementById('no-results');

      if (!posts.length) {
        container.innerHTML = '';
        noResults.style.display = 'block';
        return;
      }

      noResults.style.display = 'none';
      container.innerHTML = posts.map(p => {
        const excerpt = stripHtml(p.body).slice(0, 180) + '...';
        return `
          <a href="post.html#${p.id}" class="post-card">
            ${p.image ? `<img src="../${p.image}" alt="">` : '<div style="background:var(--primary);display:flex;align-items:center;justify-content:center;color:var(--accent);font-size:2rem;font-weight:bold;min-height:150px;">FW</div>'}
            <div class="post-info">
              <h3>${p.title}</h3>
              <div class="post-meta">${formatDate(p.date)} &middot; ${p.author}</div>
              <div class="post-excerpt">${excerpt}</div>
              <div class="post-tags">
                ${p.tags.map(t => `<span class="tag">${t}</span>`).join('')}
              </div>
            </div>
          </a>
        `;
      }).join('');
    }

    function filterPosts() {
      const query = document.getElementById('search').value.toLowerCase().trim();
      let filtered = allPosts;

      if (activeTag) {
        filtered = filtered.filter(p => p.tags.includes(activeTag));
      }

      if (query) {
        filtered = filtered.filter(p =>
          p.title.toLowerCase().includes(query) ||
          stripHtml(p.body).toLowerCase().includes(query) ||
          p.tags.some(t => t.includes(query))
        );
      }

      renderPosts(filtered);
    }

    fetch('posts.json')
      .then(r => r.json())
      .then(data => {
        allPosts = data.posts.sort((a, b) => b.date.localeCompare(a.date));

        // Build tag filters
        const allTags = [...new Set(allPosts.flatMap(p => p.tags))].sort();
        const tagContainer = document.getElementById('tag-filters');
        tagContainer.innerHTML = allTags.map(t =>
          `<button class="tag" data-tag="${t}">${t}</button>`
        ).join('');

        tagContainer.addEventListener('click', e => {
          const btn = e.target.closest('[data-tag]');
          if (!btn) return;
          const tag = btn.dataset.tag;
          if (activeTag === tag) {
            activeTag = null;
            tagContainer.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
          } else {
            activeTag = tag;
            tagContainer.querySelectorAll('.tag').forEach(t =>
              t.classList.toggle('active', t.dataset.tag === tag)
            );
          }
          filterPosts();
        });

        document.getElementById('search').addEventListener('input', filterPosts);

        renderPosts(allPosts);
      });
  </script>
</body>
</html>
